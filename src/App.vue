<script setup>
import { ref, reactive } from 'vue'

/* ===================== CATEGORIES ===================== */
const categories = [
  { id: 'bakery', label: '–í–∏–ø—ñ—á–∫–∞', icon: 'ü•ñ' },
  
  { id: 'fruits', label: '–§—Ä—É–∫—Ç–∏', icon: 'üçé' },
  { id: 'vegetables', label: '–û–≤–æ—á—ñ', icon: 'ü•¶' },
  
  { id: 'meat', label: '–ú‚Äô—è—Å–æ —Ç–∞ –º‚Äô—è—Å–Ω—ñ –ø—Ä–æ–¥—É–∫—Ç–∏', icon: 'ü•©' },
  { id: 'fish', label: '–†–∏–±–∞ —Ç–∞ –º–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç–∏', icon: 'üêü' },
  
  { id: 'eggs', label: '–Ø–π—Ü—è', icon: 'ü•ö' },
  
  { id: 'dairy', label: '–ú–æ–ª–æ—á–Ω—ñ –ø—Ä–æ–¥—É–∫—Ç–∏', icon: 'ü•õ' },
  { id: 'fats', label: '–ñ–∏—Ä–∏', icon: 'üßà' },
  
  { id: 'grains', label: '–ö—Ä—É–ø–∏ —Ç–∞ –±–æ–±–æ–≤—ñ', icon: 'üåæ' },
  { id: 'pasta', label: '–ú–∞–∫–∞—Ä–æ–Ω–Ω—ñ –≤–∏—Ä–æ–±–∏', icon: 'üçù' },
  
  { id: 'spices', label: '–°–ø–µ—Ü—ñ—ó —Ç–∞ —Ç—Ä–∞–≤–∏', icon: 'üåø' },
  { id: 'sauces', label: '–°–æ—É—Å–∏', icon: 'ü•´' },
  
  { id: 'sweets', label: '–°–æ–ª–æ–¥–æ—â—ñ', icon: 'üç´' },
  { id: 'drinks', label: '–ù–∞–ø–æ—ó', icon: 'ü•§' },
]

/* ===================== INVENTORY ===================== */
const inventory = reactive({
  meat: [
    { name: '–ö—É—Ä–∏—Ü—è —Ü—ñ–ª–∞ –æ–±—Ä—ñ–∑–∞–Ω–∞', icon: 'üçó', amount: 720, unit: 'g', units: ['g','kg'], tags: ['—Å–≤—ñ–∂–µ'] },
    { name: '–†–µ–±—Ä–∞ —Å–≤–∏–Ω–Ω—ñ', icon: 'ü•©', amount: 250, unit: 'g', units: ['g','kg'], tags: ['—Å–≤—ñ–∂–µ'] },
    { name: '–°–∞–ª–æ –Ω–µ —Å–æ–ª–µ–Ω–µ', icon: 'ü•ì', amount: 600, unit: 'g', units: ['g','kg'], tags: ['—Å–≤—ñ–∂–µ'] },
    { name: '–°–∞–ª–æ —Å–æ–ª–µ–Ω–µ', icon: 'ü•ì', amount: 350, unit: 'g', units: ['g','kg'], tags: ['—Å–≤—ñ–∂–µ'] },
    { name: '–°–≤–∏–Ω–Ω—ñ —Å—Ç–µ–π–∫–∏', icon: 'ü•©', amount: 400, unit: 'g', units: ['g','kg'], tags: ['—Å–≤—ñ–∂–µ'] },
    { name: '–§–∞—Ä—à —Å–≤–∏–Ω—è—á–∏–π', icon: 'ü•©', amount: 144, unit: 'g', units: ['g','kg'], tags: ['—Å–≤—ñ–∂–µ'] },
    { name: '–§—ñ–ª–µ —Å–≤–∏–Ω–∏–Ω–∞', icon: 'ü•©', amount: 1000, unit: 'g', units: ['g','kg'], tags: ['—Å–≤—ñ–∂–µ'] }
  ],
  fish: [
    { name: '–õ–æ—Å–æ—Å—å –∑–∞—Å–æ–ª–µ–Ω–∏–π', icon: 'üêü', amount: 130, unit: 'g', units: ['g','kg'], tags: ['—Å–≤—ñ–∂–µ'] }
  ],
  eggs: [
    { name: '–Ø–π—Ü—è –∫—É—Ä—è—á—ñ', icon: 'ü•ö', amount: 16, unit: '—à—Ç', units: ['—à—Ç'], tags: ['—Å–≤—ñ–∂–µ'] }
  ],
  dairy: [
    { name: '–¢–≤–æ—Ä–æ–≥ –≥—Ä—É–¥–∫–æ–≤–∏–π', icon: 'üßÄ', amount: 230, unit: 'g', units: ['g','kg'], tags: ['–∑–∞–º–æ—Ä–æ–∂–µ–Ω–æ'] },
    { name: '–¢–≤–æ—Ä–æ–≥ jemny', icon: 'üßÄ', amount: 130, unit: 'g', units: ['g','kg'], tags: ['—Å–≤—ñ–∂–µ'] },
    { name: '–ú–æ–ª–æ–∫–æ', icon: 'ü•õ', amount: 700, unit: 'ml', units: ['ml','l'], tags: ['—Å–≤—ñ–∂–µ'] }
  ],
  grains: [
    { name: '–ë—É–ª–≥—É—Ä', icon: 'üåæ', amount: 96, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–ì—Ä–µ—á–∫–∞', icon: 'üåæ', amount: 496, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–ö—É—Å–∫—É—Å', icon: 'üåæ', amount: 196, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–ü—à–æ–Ω–æ', icon: 'üåæ', amount: 320, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–†–∏—Å Basmati', icon: 'üåæ', amount: 36, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–†–∏—Å Jasmine', icon: 'üåæ', amount: 0, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–ß–µ—á–µ–≤–∏—Ü—è', icon: 'üåæ', amount: 195, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] }
  ],
  pasta: [
    { name: '–í–µ—Ä–º—ñ—à–µ–ª—å', icon: 'üçù', amount: 172, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–ú–∞–∫–∞—Ä–æ–Ω–∏ –±–∞–±–æ—á–∫–∞', icon: 'üçù', amount: 300, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–ú–∞–∫–∞—Ä–æ–Ω–∏ —Ä—ñ–∑–Ω–æ–∫–æ–ª—å–æ—Ä–æ–≤—ñ', icon: 'üçù', amount: 118, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–ú–∞–∫–∞—Ä–æ–Ω–∏ —Ç—Ä—É–±–æ—á–∫–∞', icon: 'üçù', amount: 63, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–°–ø–∞–≥–µ—Ç—Ç—ñ', icon: 'üçù', amount: 52, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] }
  ],
  bakery: [
    { name: '–ë–æ—Ä–æ—à–Ω–æ –≥–ª–∞–¥–∫–µ', icon: 'ü•ñ', amount: 1119, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–í–∞–Ω—ñ–ª—å–Ω–∏–π —Ü—É–∫–æ—Ä', icon: 'üßÇ', amount: 20, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–î—Ä—ñ–∂–¥–∂—ñ —Å—É—à–µ–Ω—ñ', icon: 'ü•ñ', amount: 8, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–ú–∞–Ω–∫–∞', icon: 'üåæ', amount: 299, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–†–æ–∑–ø—É—à—É–≤–∞—á —Ç—ñ—Å—Ç–∞ –¥–æ –ø–µ—á–∏–≤–∞', icon: 'ü•ñ', amount: 48, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–†–æ–∑–ø—É—à—É–≤–∞—á —Ç—ñ—Å—Ç–∞ –¥–æ –ø—Ä—è–Ω–∏–∫—ñ–≤/–±—ñ—Å–∫–≤—ñ—Ç—É', icon: 'ü•ñ', amount: 12, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–°–æ–¥–∞', icon: 'üßÇ', amount: 228, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–°—ñ–ª—å', icon: 'üßÇ', amount: 362, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–¶—É–∫–æ—Ä', icon: 'üßÇ', amount: 674, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] }
  ],
  vegetables: [
    { name: '–ö–∞—Ä—Ç–æ–ø–ª—è', icon: 'ü•î', amount: 2000, unit: 'g', units: ['g','kg'], tags: ['—Å–≤—ñ–∂–µ'] },
    { name: '–ú–æ—Ä–∫–≤–∞', icon: 'ü•ï', amount: 0, unit: '—à—Ç', units: ['—à—Ç'], tags: ['—Å–≤—ñ–∂–µ'] },
    { name: '–û–≥—ñ—Ä–æ–∫', icon: 'ü•í', amount: 2, unit: '—à—Ç', units: ['—à—Ç'], tags: ['—Å–≤—ñ–∂–µ'] },
    { name: '–ü–µ—Ç—Ä—É—à–∫–∞', icon: 'üåø', amount: 30, unit: 'g', units: ['g','kg'], tags: ['—Å–≤—ñ–∂–µ'] },
    { name: '–ü–æ–º—ñ–¥–æ—Ä', icon: 'üçÖ', amount: 3, unit: '—à—Ç', units: ['—à—Ç'], tags: ['—Å–≤—ñ–∂–µ'] },
    { name: '–¶–∏–±—É–ª—è —Ä—ñ–ø—á–∞—Å—Ç–∞', icon: 'üßÖ', amount: 0, unit: '—à—Ç', units: ['—à—Ç'], tags: ['—Å–≤—ñ–∂–µ'] }
  ],
  fruits: [
    { name: '–ö–ª—É–±–Ω—ñ–∫–∞', icon: 'üçì', amount: 450, unit: 'g', units: ['g','kg'], tags: ['—Å–≤—ñ–∂–µ'] },
    { name: '–Ø–±–ª—É–∫–∞', icon: 'üçé', amount: 500, unit: 'g', units: ['g','kg'], tags: ['—Å–≤—ñ–∂–µ'] }
  ],
  spices: [
    { name: '–ö—Ä—ñ–ø', icon: 'üåø', amount: 10, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–õ–∞–≤—Ä–æ–≤–∏–π –ª–∏—Å—Ç', icon: 'üåø', amount: 5, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–û—Ä–µ–≥–∞–Ω–æ', icon: 'üåø', amount: 4, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–ü–∞–ø—Ä–∏–∫–∞ –∫–æ–ø—á–µ–Ω–∞ –º–µ–ª–µ–Ω–∞', icon: 'üå∂Ô∏è', amount: 8, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–ü–µ—Ä–µ—Ü—å –¥—É—Ö–º—è–Ω–∏–π', icon: 'üå∂Ô∏è', amount: 4, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–ü–µ—Ä–µ—Ü—å —á–æ—Ä–Ω–∏–π', icon: 'üå∂Ô∏è', amount: 7, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–ü–µ—Ä–µ—Ü—å —á–æ—Ä–Ω–∏–π —Ü—ñ–ª–∏–π', icon: 'üå∂Ô∏è', amount: 5, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–ü–µ—Ç—Ä—É—à–∫–∞', icon: 'üåø', amount: 2, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–ü—Ä–∏–ø—Ä–∞–≤–∞ –¥–ª—è –∫–∞—Ä—Ç–æ–ø–ª—ñ –ø–æ-–∞–º–µ—Ä–∏–∫–∞–Ω—Å—å–∫–∏', icon: 'üå∂Ô∏è', amount: 3, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–ü—Ä–∏–ø—Ä–∞–≤–∞ –¥–ª—è –∫–∞—Ä—Ç–æ–ø–ª—ñ –ø–æ-–∞–º–µ—Ä–∏–∫–∞–Ω—Å—å–∫–∏ #2', icon: 'üå∂Ô∏è', amount: 15, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–ü—Ä–∏–ø—Ä–∞–≤–∞ –¥–ª—è –∫—É—Ä–∏—Ü—ñ', icon: 'üå∂Ô∏è', amount: 3, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–ü—Ä–∏–ø—Ä–∞–≤–∞ –¥–ª—è –º\'—è—Å–∞', icon: 'üå∂Ô∏è', amount: 1, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–ü—Ä–∏–ø—Ä–∞–≤–∞ –¥–ª—è –ø–ª–æ–≤—É', icon: 'üå∂Ô∏è', amount: 10, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–ü—Ä–∏–ø—Ä–∞–≤–∞ –¥–æ —à–∞—à–ª–∏–∫—É', icon: 'üå∂Ô∏è', amount: 28, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–ü—Ä–∏–ø—Ä–∞–≤–∞ –¥–æ —à–∞—à–ª–∏–∫—É #2', icon: 'üå∂Ô∏è', amount: 75, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–ü—Ä–∏–ø—Ä–∞–≤–∞ —Å–∏–ø–∫–∞', icon: 'üå∂Ô∏è', amount: 111, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–†–æ–∑–º–∞—Ä–∏–Ω', icon: 'üåø', amount: 18, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–°—É–º—ñ—à –∑–µ–ª–µ–Ω—ñ', icon: 'üåø', amount: 10, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–•–º–µ–ª—ñ —Å—É–Ω–µ–ª—ñ', icon: 'üåø', amount: 23, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–•–º–µ–ª—ñ —Å—É–Ω–µ–ª—ñ #2', icon: 'üåø', amount: 30, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] }
  ],
  drinks: [
    { name: '–ö–æ—Ñ–µ –º–µ–ª–µ–Ω–∞', icon: '‚òï', amount: 85, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–ß–∞–π —Ä–æ–º–∞—à–∫–æ–≤–∏–π', icon: 'üçµ', amount: 2, unit: '—à—Ç', units: ['—à—Ç'], tags: ['—Å—É—Ö–µ'] },
    { name: '–ß–∞–π —á–æ—Ä–Ω–∏–π', icon: 'üçµ', amount: 3, unit: '—à—Ç', units: ['—à—Ç'], tags: ['—Å—É—Ö–µ'] },
    { name: '–ö–æ—Ñ–µ —Ç–∞–±–ª–µ—Ç–∫–∏ –¢–∞—Å—ñ–º–æ –ú—ñ–ª–∫–∞', icon: '‚òï', amount: 4, unit: '—à—Ç', units: ['—à—Ç'], tags: ['—Å—É—Ö–µ'] }
  ],
  sweets: [
    { name: '–í–∞—Ä–µ–Ω–Ω—è –∫–ª—É–±–Ω—ñ–∫–∏', icon: 'üçØ', amount: 650, unit: 'g', units: ['g','kg'], tags: ['—Å–≤—ñ–∂–µ'] },
    { name: '–í–∞—Ä–µ–Ω–Ω—è –º–∞–ª–∏–Ω–æ–≤–µ', icon: 'üçØ', amount: 1000, unit: 'g', units: ['g','kg'], tags: ['—Å–≤—ñ–∂–µ'] },
    { name: '–í–∞—Ä–µ–Ω–Ω—è —Å–º–æ—Ä–æ–¥–∏–Ω–∏', icon: 'üçØ', amount: 400, unit: 'g', units: ['g','kg'], tags: ['—Å–≤—ñ–∂–µ'] },
    { name: '–í–∞—Ñ–µ–ª—å–Ω—ñ –≤–∞—Ñ–µ–ª—å–Ω—ñ –ª–∏—Å—Ç–∏', icon: 'üç™', amount: 18, unit: '—à—Ç', units: ['—à—Ç'], tags: ['—Å–≤—ñ–∂–µ'] },
    { name: '–ö–∞–∫–∞–æ –Ω–µ—Å–∫–≤—ñ–∫', icon: 'üç´', amount: 110, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–ö–∞–∫–∞–æ –ø—É–¥—Ä–∞', icon: 'üç´', amount: 80, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] },
    { name: '–ú–µ–¥–æ–≤—ñ –∫—ñ–ª—å—Ü—è', icon: 'üçØ', amount: 174, unit: 'g', units: ['g','kg'], tags: ['—Å–≤—ñ–∂–µ'] },
    { name: '–†–æ–¥–∑–∏–Ω–∫–∏', icon: 'üçá', amount: 57, unit: 'g', units: ['g','kg'], tags: ['—Å—É—Ö–µ'] }
  ],
  fats: [
    { name: '–ú–∞—Å–ª–æ —Å–ª–∏–≤–æ—á–Ω–µ', icon: 'üßà', amount: 395, unit: 'g', units: ['g','kg'], tags: ['—Å–≤—ñ–∂–µ'] },
    { name: '–û–ª—ñ—è —Å–æ–Ω—è—à–Ω–∏–∫–æ–≤–∞', icon: 'ü´í', amount: 500, unit: 'ml', units: ['ml','l'], tags: ['—Å–≤—ñ–∂–µ'] },
  ],
  sauces: [
    { name: '–ö–µ—Ç—á—É–ø –¥–æ —à–∞—à–ª–∏–∫—É', icon: 'ü•´', amount: 1, unit: '—à—Ç', units: ['—à—Ç'], tags: ['—Å–≤—ñ–∂–µ'] },
    { name: '–°–æ—É—Å –∞–¥–∂–∏–∫–∞', icon: 'ü•´', amount: 1, unit: '—à—Ç', units: ['—à—Ç'], tags: ['—Å–≤—ñ–∂–µ'] },
    { name: '–°–æ—É—Å –≥—ñ—Ä—á–∏—Ü—è –º—ñ—Ü–Ω–∞', icon: 'ü•´', amount: 1, unit: '—à—Ç', units: ['—à—Ç'], tags: ['—Å–≤—ñ–∂–µ'] },
    { name: '–°–æ—É—Å —Å–æ–ª–æ–¥–∫–∏–π —á–∏–ª—ñ', icon: 'ü•´', amount: 1, unit: '—à—Ç', units: ['—à—Ç'], tags: ['—Å–≤—ñ–∂–µ'] },
    { name: '–¶–∏—Ç—Ä–æ–Ω—ñ–∫–∞', icon: 'üçã', amount: 60, unit: 'ml', units: ['ml','l'], tags: ['—Å–≤—ñ–∂–µ'] }
  ]
})

/* ===================== UI STATE ===================== */
const activeCategory = ref(null)
const activeItem = ref(null)
const inputValue = ref('')
const displayUnit = ref('')
const editingMode = ref('edit') // 'edit' | 'add'

/* ===================== ICONS ===================== */
const iconList = [
  'ü•©','üçó','ü•ì','üçñ','üêü','üßÄ','ü•õ','ü•¶','üçé','üçì','üåæ','üçù','üç¨','üßÇ','üå∂Ô∏è',
  'üçÖ','üßà','ü´í','üÜï','ü•ñ','üçØ','üç™','üçã','üçá','ü•ï','ü•î','ü•í','üßÖ','‚òï','üçµ','ü•ö','üåø','ü•´','ü•¨','ü´ô'
]

/* ===================== HELPERS ===================== */
const pretty = item => {
  switch(item.unit){
    case 'kg': return `${(item.amount/1000).toFixed(2)} –∫–≥`
    case 'g': return `${item.amount} –≥`
    case 'l': return `${(item.amount/1000).toFixed(2)} –ª`
    case 'ml': return `${item.amount} –º–ª`
    default: return `${item.amount} —à—Ç`
  }
}

const formatForDisplay = (amount, unit) => ['kg','l'].includes(unit) ? (amount/1000).toString() : amount.toString()
const toBase = (value, unit) => {
  const v = parseFloat(value || 0)
  return ['kg','l'].includes(unit) ? Math.round(v*1000) : Math.round(v)
}

/* ===================== MODAL ===================== */
function openItem(item){
  activeItem.value = { ...item, original: item }
  displayUnit.value = item.unit
  inputValue.value = formatForDisplay(item.amount, item.unit)
  editingMode.value = 'edit'
  activeItem.value.units = ['g','kg','ml','l'].includes(item.unit) ? [item.unit === 'g'||item.unit==='kg'? 'g':'ml','kg' || 'l'] : [item.unit]
}

function openAddModal(){
  if(!activeCategory.value) return alert('–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é!')
  activeItem.value = { name:'', icon:'üÜï', amount:0, unit:'g', units:['g','kg','ml','l','—à—Ç'], tags:['—Å–≤—ñ–∂–µ'] }
  displayUnit.value = 'g'
  inputValue.value = ''
  editingMode.value = 'add'
}

function closeModal(){ activeItem.value = null; inputValue.value='' }
function saveItem(){
  if(!activeItem.value.name.trim()) return alert('–í–∫–∞–∂—ñ—Ç—å –Ω–∞–∑–≤—É –ø—Ä–æ–¥—É–∫—Ç—É!')
  activeItem.value.amount = toBase(inputValue.value, displayUnit.value)
  activeItem.value.unit = displayUnit.value
  if(!inventory[activeCategory.value]) inventory[activeCategory.value]=[]
  editingMode.value==='add'?inventory[activeCategory.value].push({...activeItem.value}):Object.assign(activeItem.value.original, activeItem.value)
  closeModal()
}

function press(key){ inputValue.value = key==='‚å´'? inputValue.value.slice(0,-1):inputValue.value+key }
function removeItem(item){ const idx = inventory[activeCategory.value].indexOf(item); if(idx!==-1) inventory[activeCategory.value].splice(idx,1) }
function toggleTag(tag){ const i = activeItem.value.tags.indexOf(tag); i!==-1?activeItem.value.tags.splice(i,1):activeItem.value.tags.push(tag) }

</script>

<template>
<div class="min-h-screen bg-gray-100 p-4">

  <!-- CATEGORIES -->
  <div v-if="!activeCategory" class="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 gap-4">
    <button v-for="c in categories" :key="c.id" @click="activeCategory=c.id" class="h-full p-5 bg-white rounded-xl shadow-lg flex flex-col items-center justify-center active:scale-95 transition">
      <div class="text-6xl mb-3">{{ c.icon }}</div>
      <div class="text-sm font-semibold line-clamp-2">{{ c.label }}</div>
    </button>
  </div>

  <!-- ITEMS -->
    <div v-else>
    <div class="flex justify-between mb-4 items-center">
      <button class="text-lg font-semibold text-blue-600" @click="activeCategory=null">‚Üê –ù–∞–∑–∞–¥</button>
      <button class="px-4 py-2 bg-green-500 text-white rounded-2xl" @click="openAddModal">–î–æ–¥–∞—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç</button>
    </div>
  <div class="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 gap-4">
  <div v-for="item in inventory[activeCategory]" :key="item.name" class="relative flex flex-col items-center relative">
  <button @click="openItem(item)" class="h-full flex flex-col items-center w-full justify-between p-3 rounded-2xl bg-white shadow-lg">
    <div class="text-6xl flex justify-center mt-2">{{ item.icon }}</div>
    <div class="text-center mt-2">
      <div class="text-sm font-semibold line-clamp-2">{{ item.name }}</div>
      <div class="text-base font-bold mt-1">{{ pretty(item) }}</div>
    </div>
    <div class="flex flex-wrap justify-center gap-1 mt-2 max-h-10 overflow-auto">
      <span v-for="tag in item.tags" :key="tag" class="bg-gray-200 text-gray-800 px-2 py-1 rounded-full text-xs">{{ tag }}</span>
    </div>
  </button>
  <button @click.stop="removeItem(item)" class="absolute top-2 right-2 text-red-500 text-xl bg-white rounded-full p-1 shadow">‚úñ</button>
</div>
    </div>

</div>


  <!-- MODAL / NUMPAD -->
  <div v-if="activeItem" class="fixed inset-0 bg-black/40 flex items-end sm:items-center justify-center">
    <div class="bg-white w-full sm:w-[420px] rounded-t-3xl sm:rounded-3xl p-5">
      <div class="text-center mb-2">
        <select v-model="activeItem.icon" class="text-4xl text-center w-full mb-2">
          <option v-for="i in iconList" :key="i" :value="i">{{ i }}</option>
        </select>
        <input v-model="activeItem.name" class="w-full border-b text-center text-xl font-semibold mb-2" placeholder="–ù–∞–∑–≤–∞ –ø—Ä–æ–¥—É–∫—Ç—É"/>
      </div>

      <div class="text-center text-4xl font-bold mb-4">{{ inputValue || 0 }}</div>
      <div class="grid grid-cols-3 gap-3 mb-4">
        <button v-for="k in ['1','2','3','4','5','6','7','8','9','.','0','‚å´']" :key="k" @click="press(k)" class="bg-gray-100 rounded-2xl p-6 text-2xl font-semibold active:scale-95">{{ k }}</button>
      </div>

      <div class="flex gap-3 mb-4">
        <button v-for="u in activeItem.units" :key="u" @click="displayUnit=u" :class="['flex-1 p-4 rounded-2xl text-xl font-semibold', displayUnit===u?'bg-blue-500 text-white':'bg-gray-100']">{{ u }}</button>
      </div>

      <div class="flex gap-2 flex-wrap mb-4">
        <button v-for="tag in ['—Å–≤—ñ–∂–µ','–∑–∞–º–æ—Ä–æ–∂–µ–Ω–æ','–º–∞—Ä–∏–Ω–æ–≤–∞–Ω–µ']" :key="tag" @click="toggleTag(tag)" :class="['px-3 py-1 rounded-full text-xs', activeItem.tags.includes(tag)?'bg-blue-500 text-white':'bg-gray-200 text-gray-800']">{{ tag }}</button>
      </div>

      <div class="flex gap-3">
        <button @click="closeModal" class="flex-1 p-4 rounded-2xl bg-gray-200 text-xl">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        <button @click="saveItem" class="flex-1 p-4 rounded-2xl bg-green-500 text-white text-xl font-semibold">OK</button>
      </div>
    </div>
  </div>
</div>
</template>
